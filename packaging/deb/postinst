#!/bin/sh
set -e

echo "[eid-client] Post-installation..."

# 1. Activer et démarrer PC/SC
if command -v systemctl >/dev/null 2>&1; then
    systemctl enable pcscd >/dev/null 2>&1 || true
    systemctl start pcscd >/dev/null 2>&1 || true
fi

# 2. Recharger les règles udev (lecteur USB)
udevadm control --reload-rules || true
udevadm trigger || true

# 3. Créer le binaire client
if [ -d /opt/eid-client ]; then
    ln -sf /opt/eid-client/scripts/run_safe.sh /usr/local/bin/eid-client
    chmod +x /opt/eid-client/scripts/run_safe.sh
fi

# 4. Message final
echo "[eid-client] Installation terminée. Vous pouvez maintenant lancer 'eid-client'."
exit 0
